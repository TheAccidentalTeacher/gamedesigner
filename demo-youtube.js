/**
 * Simple Demo of YouTube API Functionality
 * 
 * Run with: node demo-youtube.js
 * 
 * Shows a clean demo of working features
 */

import * as youtubeApi from './youtube-api.js';
import * as transcriptFetcher from './transcript-fetcher.js';

console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
console.log('   ğŸ“º Phase 8: YouTube Video Intelligence Demo');
console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

// Demo with a short educational video
const DEMO_VIDEO = 'https://www.youtube.com/watch?v=UvI-AMAtrvE'; // Khan Academy (8 min)

async function runDemo() {
  try {
    console.log('Testing with Khan Academy video...\n');
    
    // 1. Get video metadata
    console.log('1ï¸âƒ£  Fetching video metadata...');
    const metadata = await youtubeApi.getVideoMetadata(DEMO_VIDEO);
    console.log(`   âœ… Title: "${metadata.title}"`);
    console.log(`   âœ… Author: ${metadata.author}`);
    console.log(`   âœ… Duration: ${metadata.durationFormatted}`);
    console.log(`   âœ… Views: ${youtubeApi.formatViewCount(metadata.viewCount)}`);
    console.log(`   âœ… URL: ${metadata.url}\n`);
    
    // 2. Check caption availability
    console.log('2ï¸âƒ£  Checking caption availability...');
    const captions = await youtubeApi.checkCaptionAvailability(DEMO_VIDEO);
    if (captions.available) {
      console.log(`   âœ… Captions available in ${captions.languages.length} languages`);
      console.log(`   Languages: ${captions.languages.slice(0, 3).map(l => l.name).join(', ')}...`);
      console.log(`   Auto-generated: ${captions.hasAutoGenerated ? 'Yes' : 'No'}\n`);
    }
    
    // 3. Fetch transcript
    console.log('3ï¸âƒ£  Fetching video transcript...');
    const transcript = await transcriptFetcher.getTranscript(DEMO_VIDEO);
    console.log(`   âœ… Language: ${transcript.metadata.languageName}`);
    console.log(`   âœ… Segments: ${transcript.metadata.segmentCount}`);
    console.log(`   âœ… Words: ${transcript.metadata.wordCount.toLocaleString()}`);
    console.log(`   âœ… Duration: ${transcriptFetcher.formatTimestamp(transcript.metadata.totalDuration)}\n`);
    
    // 4. Show first few lines
    console.log('4ï¸âƒ£  First 5 lines of transcript:');
    for (let i = 0; i < Math.min(5, transcript.segments.length); i++) {
      const seg = transcript.segments[i];
      console.log(`   [${seg.timestamp}] ${seg.text}`);
    }
    console.log('');
    
    // 5. Get statistics
    console.log('5ï¸âƒ£  Transcript statistics:');
    const stats = transcriptFetcher.getTranscriptStats(transcript);
    console.log(`   Avg words per segment: ${stats.avgWordsPerSegment}`);
    console.log(`   Sentence count: ${stats.sentenceCount}`);
    console.log(`   Estimated reading time: ${stats.estimatedReadingTime} minutes\n`);
    
    // 6. Search within transcript
    console.log('6ï¸âƒ£  Searching for keyword "slope"...');
    const searchResults = transcriptFetcher.searchTranscript(transcript, 'slope', false);
    console.log(`   âœ… Found ${searchResults.length} matches`);
    if (searchResults.length > 0) {
      const first = searchResults[0];
      console.log(`   First match at ${first.match.timestamp}:`);
      console.log(`   "${first.match.text}"\n`);
    }
    
    // 7. Chunk for AI processing
    console.log('7ï¸âƒ£  Chunking transcript for AI analysis...');
    const chunks = transcriptFetcher.chunkTranscript(transcript, 60);
    console.log(`   âœ… Created ${chunks.length} chunks (60s max each)`);
    console.log(`   Chunk 1: [${chunks[0].timestamp}] ${chunks[0].segmentCount} segments, ${chunks[0].text.split(' ').length} words`);
    console.log(`   Chunk 2: [${chunks[1].timestamp}] ${chunks[1].segmentCount} segments, ${chunks[1].text.split(' ').length} words\n`);
    
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('   âœ… All features working perfectly!');
    console.log('   Ready to build UI integration.');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
    
  } catch (error) {
    console.error('\nâŒ Error:', error.message);
    console.error(error);
    process.exit(1);
  }
}

runDemo();
